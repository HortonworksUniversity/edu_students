{"paragraphs":[{"text":"%md\n# About\n**Lab:** Exploring Query Execution\n**Objective:** Explore how Spark executes RDD and DataFrame/Dataset queries.\n**File locations:**\n    HDFS: /user/zeppelin/hive/telco.db/accounts\n          /user/zeppelin/weblogs\n          /user/zeppelin/devices.json\n          /user/zeppelin/accountdevice\n    Hive tables: telco.accounts\n**Successful outcome:** \n**Before you begin:** \n**Related lessons:** \n\n---","user":"sysadmin","dateUpdated":"2020-06-04T21:06:57+0000","config":{"tableHide":true,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>About</h1>\n<p><strong>Lab:</strong> Exploring Query Execution\n<br  /><strong>Objective:</strong> Explore how Spark executes RDD and DataFrame/Dataset queries.\n<br  /><strong>File locations:</strong></p>\n<pre><code>HDFS: /user/hive/warehouse/devsh.db/accounts\n      /devsh_loudacre/weblogs\n      /devsh_loudacre/devices.json\n      /devsh_loudacre/accountdevice\nHive tables: devsh.accounts\n</code></pre>\n<p><strong>Successful outcome:</strong>\n<br  /><strong>Before you begin:</strong>\n<br  /><strong>Related lessons:</strong></p>\n<hr />\n"}]},"apps":[],"jobName":"paragraph_1591304768136_876196938","id":"20181126-092644_1457476546","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:23937"},{"text":"%md\n# Setup","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"tableHide":true,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>Setup</h1>\n<p><strong>Important:</strong> This exercise depends on <strong><em> ***Insert previous exercise title here (with link?)*** </em></strong>. If you did not complete that exercise, run the course catch-up script and advance to the current exercise:</p>\n<pre><code>$ $DEVSH/scripts/catchup.sh\n</code></pre>\n"}]},"apps":[],"jobName":"paragraph_1591304768138_-1526068716","id":"20181201-044336_178705192","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23938"},{"text":"%md\n# Lab\n","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>Lab</h1>\n"}]},"apps":[],"jobName":"paragraph_1591304768139_1365809288","id":"20181126-093358_358613711","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23939"},{"text":"%md\n### Explore Partitioning of File-Based RDDs","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h3>Explore Partitioning of File-Based RDDs</h3>\n"}]},"apps":[],"jobName":"paragraph_1591304768139_-1195696786","id":"20200426-002311_1962808726","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23940"},{"title":"1 - Note the number and size of accounts data files in HDFS","text":"%md\nReview the accounts data files in HDFS. (`user/zeppelin/accounts`) Take note of the number and sizes of files.","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591304768140_-1335521402","id":"20200426-002408_1814900362","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23941"},{"text":"%sh\nhdfs dfs -ls /user/zeppelin/hive/telco.db/accounts","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"editorSetting":{"language":"sh","editOnDblClick":false,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/sh","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Found 13 items\ndrwx------   - zeppelin hdfs          0 2020-05-21 12:02 /user/zeppelin/.Trash\ndrwxr-xr-x   - zeppelin hdfs          0 2020-05-21 17:42 /user/zeppelin/.sparkStaging\ndrwxr-xr-x   - zeppelin hdfs          0 2020-05-21 20:36 /user/zeppelin/accountdevice\ndrwxr-xr-x   - zeppelin hdfs          0 2020-05-22 20:49 /user/zeppelin/accounts_zip94913\ndrwxrwxrwx   - zeppelin hdfs          0 2020-05-22 23:30 /user/zeppelin/conf\n-rw-r--r--   3 zeppelin hdfs       5483 2020-05-21 18:32 /user/zeppelin/devices.json\ndrwxr-xr-x   - zeppelin hdfs          0 2020-05-22 21:50 /user/zeppelin/devices_parquet\ndrwxr-xr-x   - zeppelin hdfs          0 2020-05-22 04:14 /user/zeppelin/iplist\ndrwxr-xr-x   - zeppelin hdfs          0 2020-05-21 05:55 /user/zeppelin/kb\ndrwxr-xr-x   - zeppelin hdfs          0 2020-05-22 22:16 /user/zeppelin/name_dev\ndrwxrwxrwx   - zeppelin hdfs          0 2020-05-22 23:30 /user/zeppelin/notebook\ndrwxrwxrwx   - zeppelin hdfs          0 2020-04-29 00:53 /user/zeppelin/test\ndrwxr-xr-x   - zeppelin hdfs          0 2020-05-22 01:49 /user/zeppelin/weblogs\n"}]},"apps":[],"jobName":"paragraph_1591304768141_-198026912","id":"20200522-233345_410445506","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23942"},{"title":"2 - Create an RDD using the accounts data","text":"%md\nCreate an RDD called `accountsRDD` by reading the accounts data, splitting it by commas, and keying it by account ID, which is the first field of each line.","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591304768142_608184264","id":"20200426-002628_1889296219","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23943"},{"text":"%spark2\nval accountsRDD = sc.\ntextFile(\"/user/zeppelin/hive/telco.db/accounts\").\nmap(line => line.split(',')).\nmap(account => (account(0),account))","user":"sysadmin","dateUpdated":"2020-06-04T21:50:12+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1591304768143_-2020477281","id":"20200426-002657_1953644645","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23944"},{"title":"3 - Find the number of partitions in the new RDD","text":"%spark2\naccountsRDD.getNumPartitions","user":"sysadmin","dateUpdated":"2020-06-04T21:50:19+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591304768143_-543379439","id":"20200426-002706_444177779","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23945"},{"title":"4 - Review the lineage and execution plan of accountsRDD","text":"%md\nUse `toDebugString` to view the lineage and execution plan of `accountsRDD`. How many partitions are in the resulting RDD? How may stages does the query have?","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591304768144_-1227927223","id":"20200426-002725_436524214","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23946"},{"text":"%spark2\naccountsRDD.toDebugString","user":"sysadmin","dateUpdated":"2020-06-04T21:50:38+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591304768145_-2079289149","id":"20200426-002725_1871429356","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23947"},{"text":"%md\n### Explore Execution of RDD Queries","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h3>Explore Execution of RDD Queries</h3>\n"}]},"apps":[],"jobName":"paragraph_1591304768146_-1780492354","id":"20200426-002724_1932934908","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23948"},{"title":"5 - Trigger the execution of a job","text":"%md\nCall `count` on `accountsRDD` to count the number of accounts. This will trigger execution of a job.","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591304768146_-709378403","id":"20200426-002723_2144549000","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23949"},{"text":"%spark2\n","user":"sysadmin","dateUpdated":"2020-06-04T21:50:46+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591304768147_-408839188","id":"20200426-002723_1061198580","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23950"},{"title":"6 - View the Spark application UI","text":"%md\nIn the browser, view the application in the YARN RM UI and click through to view the Spark Application UI.","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"tableHide":true,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>In the browser, view the application in the YARN RM UI using the provided bookmark (or <a href=\"http://localhost:8088\">http://localhost:8088</a> and click through to view the Spark Application UI.</p>\n<p><strong><em> !!!! Does this link work? !!! </em></strong></p>\n"}]},"apps":[],"jobName":"paragraph_1591304768148_-697953522","id":"20200426-002722_1296221776","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23951"},{"title":"7 - Confirm that the execution of the job matches the results from toDebugString","text":"%md\nMake sure the **Jobs** tab is selected, and review the list of completed jobs. The most recent job, which you triggered by calling count, should be at the top of the list. (Note that the job description is usually based on the action that triggered the job execution.) Confirm that the number of stages is correct, and the number of tasks completed for the job matches the number of RDD partitions you noted when you used `toDebugString`.","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591304768148_-464729484","id":"20200426-003259_783721808","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23952"},{"title":"8 - View the details of the job","text":"%md\nClick on the job description to view details of the job. This will list all the stages in the job, which in this case is one.","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591304768149_-1590269785","id":"20200426-003259_1099747477","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23953"},{"title":"9 - View the diagram of the execution plan","text":"%md\nClick on **DAG Visualization** to see a diagram of the execution plan based on the RDD's lineage. The main diagram displays only the stages, but if you click on a stage, it will show you the tasks within that stage.","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591304768149_-900529010","id":"20200426-003415_1588367725","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23954"},{"title":"10 - Explore the partitioning and DAG of a more complex query","text":"%md\n*Optional:* Explore the partitioning and DAG of a more complex query like the one below. Before you view the execution plan or job details, try to figure out how many stages the job will have.\n\nThis query loads Loudacre's web log data, and calculates how many times each user visited. Then it joins that user count data with account data for each user.","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591304768150_1984805171","id":"20200426-003259_310142277","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23955"},{"text":"%spark2\nval logs = sc.textFile(\"/user/zeppelin/weblogs\")\n\nval userReqsRDD = logs.map(line => line.split(' ')).\nmap(words => (words(2),1)).\nreduceByKey((v1,v2) => v1 + v2)\n\nval accountHitsRDD = accountsRDD.join(userReqsRDD)\naccountHitsRDD.saveAsTextFile(\"/user/zeppelin/account_hits\")","user":"sysadmin","dateUpdated":"2020-06-04T21:51:56+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591304768151_559941956","id":"20200426-003258_1413992919","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23956"},{"text":"%md\n**Note:** If you execute the query multiple times, you may note that some tasks within a stage are marked as \"skipped.\"\" This is because whenever a shuffle operation is executed, Spark temporarily caches the data that was shuffled. Subsequent executions of the same query re-use that data if it's available to save some steps and improve performance.","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"tableHide":true,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p><strong>Note:</strong> If you execute the query multiple times, you may note that some tasks within\n<br  />a stage are marked as &ldquo;skipped.&ldquo;&rdquo; This is because whenever a shuffle operation\n<br  />is executed, Spark temporarily caches the data that was shuffled. Subsequent\n<br  />executions of the same query re-use that data if it's available to save some steps and\n<br  />improve performance.</p>\n"}]},"apps":[],"jobName":"paragraph_1591304768152_-78335653","id":"20200426-003257_150288643","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23957"},{"text":"%md\n### Explore Execution of DataFrame Queries","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h3>Explore Execution of DataFrame Queries</h3>\n"}]},"apps":[],"jobName":"paragraph_1591304768152_-162697299","id":"20200426-002721_938055623","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23958"},{"title":"11 - Create a DataFrame of active accounts","text":"%md\nCreate a DataFrame of active accounts from the `accounts` table in the `telco` database.","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591304768153_-150828021","id":"20200426-002721_1060215009","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23959"},{"text":"%spark2\nval accountsDF = spark.read.table(\"telco.accounts\")\n\nval activeAccountsDF = accountsDF.\nselect(\"acct_num\").\nwhere($\"acct_close_dt\".isNull)","user":"sysadmin","dateUpdated":"2020-06-04T21:52:25+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591304768154_726516257","id":"20200426-002720_315865919","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23960"},{"title":"12 - View the full execution plan for the new DataFrame","text":"%spark2\nactiveAccountsDF.explain(true)","user":"sysadmin","dateUpdated":"2020-06-04T21:52:42+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591304768155_333819296","id":"20200426-002719_2094070605","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23961"},{"text":"%md\nCan you locate the line in the physical plan corresponding to the command to load the `telco.accounts` table into a DataFrame?\n\nHow many stages do you think this query has?","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"tableHide":true,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>Can you locate the line in the physical plan corresponding to the command to load\n<br  />the <code>devsh.accounts</code> table into a DataFrame?</p>\n<p>How many stages do you think this query has?</p>\n"}]},"apps":[],"jobName":"paragraph_1591304768155_343748043","id":"20200426-002717_1757149911","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23962"},{"title":"13 - Call the DataFrame's show function to execute the query","text":"%spark2\n","user":"sysadmin","dateUpdated":"2020-06-04T21:52:54+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591304768156_751764553","id":"20200426-002717_1959166962","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23963"},{"title":"14 - Use the Spark Application UI to view the query","text":"%md\nView the Spark Application UI and choose the **SQL** tab. This displays a list of DataFrame and Dataset queries you have executed, with the most recent query at the top.","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591304768157_-1475806757","id":"20200426-030300_272260684","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23964"},{"title":"15 - View the query's execution plan","text":"%md\nClick the description for the top query to see the visualization of the query's execution. You can also see the query's full execution plan by opening the **Details** panel below the visualization graph.","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591304768158_721348384","id":"20200426-030259_1650065573","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23965"},{"title":"16 - Review the query's execution plan","text":"%md\nThe first step in the execution is a `HiveTableScan`, which loaded the account data into the DataFrame. Hover your mouse over the step to show the step's execution plan. Compare that to the physical plan for the query. Note that it is the same as the last line in the physical execution plan, because it is the first step to execute. Did you correctly identify this line in the execution plan as the one corresponding to the `DataFrame.read.table` operation?","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591304768159_-2048335287","id":"20200426-030259_1256056256","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23966"},{"title":"17 - View the job details for the query","text":"%md\nClick the **SQL** tab to return to the main SQL query summary tab. The **Job IDs** column provides links to the jobs that executed as part of this query execution. In this case, the query consisted of just a single job. Click the job's ID to view the job details. This will display a list of stages that were completed for the query. How many stages executed? Is that the number of stages you predicted it would be?","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591304768160_1894475976","id":"20200426-030258_341547260","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23967"},{"title":"18 - View metrics of the execution","text":"%md\n*Optional:* Click the description of the stage to view metrics on the execution of the stage and its tasks.","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591304768160_-1323072098","id":"20200426-030258_1940765022","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23968"},{"title":"19 - Joining different data sources","text":"%md\nThe previous query was very simple, involving just a single data source with a where to return only active accounts. Try executing a more complex query that joins data from two different data sources.\n\nThis query reads in the `accountdevice` data file, which maps account IDs to associated device IDs. Then it joins that data with the DataFrame of active accounts you created above. The result is DataFrame consisting of all device IDs in use by currently active accounts.","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"tableHide":true,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>The previous query was very simple, involving just a single data source with a\n<br  />where to return only active accounts. Try executing a more complex query that\n<br  />joins data from two different data sources.</p>\n<p>This query reads in the <code>accountdevice</code> data file, which maps account IDs to\n<br  />associated device IDs. Then it joins that data with the DataFrame of active accounts\n<br  />you created above. The result is DataFrame consisting of all device IDs in use by\n<br  />currently active accounts.</p>\n"}]},"apps":[],"jobName":"paragraph_1591304768161_-298322300","id":"20200426-030258_69484237","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23969"},{"text":"%spark2\nval accountDeviceDF = spark.read.\noption(\"header\",\"true\").\noption(\"inferSchema\",\"true\").\ncsv(\"/user/zeppelin/accountdevice\")\n\nval activeAcctDevsDF = activeAccountsDF.\njoin(accountDeviceDF,$\"acct_num\" === $\"account_id\").\nselect($\"device_id\")","user":"sysadmin","dateUpdated":"2020-06-04T21:53:14+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591304768162_2074329196","id":"20200426-030257_1766470330","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23970"},{"title":"20 - Analyzing the execution plan","text":"%md\nReview the full execution plan using `explain`, as you did with the previous DataFrame.\n\nCan you identify which lines in the execution plan load the two different data sources?\n\nHow many stages do you think this query will execute?","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"tableHide":true,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>Review the full execution plan using <code>explain</code>, as you did with the previous\n<br  />DataFrame.</p>\n<p>Can you identify which lines in the execution plan load the two different data\n<br  />sources?</p>\n<p>How many stages do you think this query will execute?</p>\n"}]},"apps":[],"jobName":"paragraph_1591304768162_1185736380","id":"20200426-030257_1536492862","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23971"},{"text":"%spark2\n","user":"sysadmin","dateUpdated":"2020-06-04T21:53:20+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591304768163_1420987255","id":"20200426-031346_1665958761","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23972"},{"title":"21 - Analyzing the execution visualization","text":"%md\nExecute the query and review the execution visualization in the Spark UI.\n\nWhat differences do you see between the execution of the earlier query and this one?\n\nHow many stages executed? Is this what you expected?","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"tableHide":true,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>Execute the query and review the execution visualization in the Spark UI.</p>\n<p>What differences do you see between the execution of the earlier query and this\n<br  />one?</p>\n<p>How many stages executed? Is this what you expected?</p>\n"}]},"apps":[],"jobName":"paragraph_1591304768163_-844891098","id":"20200426-030256_786143272","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23973"},{"text":"%spark2\n","user":"sysadmin","dateUpdated":"2020-06-04T21:53:23+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591304768164_1742496928","id":"20200602-220140_1443082639","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23974"},{"title":"22 - Explore a query with multiple joins","text":"%md\n*Optional:* Explore an even more complex query that involves multiple joins with three data sources. You can use the last query in the solutions file for this exercise (in the `/home/devuser/bin/devsh/exercises/query-execution/solution/ directory`). That query creates a list of device IDs, makes, and models, and the number of active accounts that use that type of device, sorted in order from most popular device type to least.","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"tableHide":true,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>!!! Solution doesn't answer this question !!!</h2>\n"}]},"apps":[],"jobName":"paragraph_1591304768165_-650817419","id":"20200426-030255_969709522","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23975"},{"text":"%spark2\n","user":"sysadmin","dateUpdated":"2020-06-04T21:53:32+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591304768165_-438382770","id":"20200602-220145_823272845","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23976"},{"text":"%md\n# Result\n**You have now:** \n\n---","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>Result</h1>\n<p><strong>You have now:</strong></p>\n<hr />\n"}]},"apps":[],"jobName":"paragraph_1591304768166_-195491887","id":"20181126-133507_1472573213","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23977"},{"text":"%md\n# Solution\n---","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>Solution</h1>\n<hr />\n"}]},"apps":[],"jobName":"paragraph_1591304768167_36245658","id":"20181018-125200_1133281582","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23978"},{"text":"%md\n### Explore Partitioning of File-Based RDDs","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h3>Explore Partitioning of File-Based RDDs</h3>\n"}]},"apps":[],"jobName":"paragraph_1591304768167_1992143999","id":"20200429-202110_912512721","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23979"},{"title":"1 - Note the number and size of accounts data files in HDFS","text":"%sh\nhdfs dfs -ls /user/zeppelin/hive/telco.db/accounts/","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"editorSetting":{"language":"sh","editOnDblClick":false,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/sh","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Found 5 items\n-rw-r--r--   3 hive hdfs    4706617 2020-05-31 18:28 /warehouse/tablespace/external/hive/telco_stage.db/accounts_stage/part-m-00000\n-rw-r--r--   3 hive hdfs    4693530 2020-05-31 18:28 /warehouse/tablespace/external/hive/telco_stage.db/accounts_stage/part-m-00001\n-rw-r--r--   3 hive hdfs    4674529 2020-05-31 18:28 /warehouse/tablespace/external/hive/telco_stage.db/accounts_stage/part-m-00002\n-rw-r--r--   3 hive hdfs    4662646 2020-05-31 18:28 /warehouse/tablespace/external/hive/telco_stage.db/accounts_stage/part-m-00003\n-rw-r--r--   3 hive hdfs        129 2020-05-31 18:28 /warehouse/tablespace/external/hive/telco_stage.db/accounts_stage/part-m-00004\n"}]},"apps":[],"jobName":"paragraph_1591304768168_-1165638862","id":"20200429-202127_377500485","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23980"},{"title":"2 - Create an RDD using the accounts data","text":"%spark2\nval accountsRDD = sc.textFile(\"/user/zeppelin/hive/telco.db/accounts\").map(line => line.split(',')).map(accountFields => (accountFields(0),accountFields))","user":"sysadmin","dateUpdated":"2020-06-04T21:54:13+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1591304768169_16558751","id":"20200429-202212_2105766018","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23981"},{"title":"3 - Find the number of partitions in the new RDD","text":"%spark2\naccountsRDD.getNumPartitions","user":"sysadmin","dateUpdated":"2020-06-04T21:54:18+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"5\n"}]},"apps":[],"jobName":"paragraph_1591304768170_1167605405","id":"20200429-202210_1469133159","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23982"},{"title":"4 - Review the lineage and execution plan of accountsRDD","text":"%spark2\naccountsRDD.toDebugString","user":"sysadmin","dateUpdated":"2020-06-04T21:54:40+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"(5) PythonRDD[165] at RDD at PythonRDD.scala:52 []\n |  /warehouse/tablespace/external/hive/telco_stage.db/accounts_stage MapPartitionsRDD[164] at textFile at NativeMethodAccessorImpl.java:0 []\n |  /warehouse/tablespace/external/hive/telco_stage.db/accounts_stage HadoopRDD[163] at textFile at NativeMethodAccessorImpl.java:0 []\n"}]},"apps":[],"jobName":"paragraph_1591304768171_-1246788391","id":"20200429-202209_1709217881","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23983"},{"text":"%md\n### Explore Execution of RDD Queries","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"title":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h3>Explore Execution of RDD Queries</h3>\n"}]},"apps":[],"jobName":"paragraph_1591304768171_621109555","id":"20200429-202207_1214551008","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23984"},{"title":"5 - Trigger the execution of a job","text":"%spark2\naccountsRDD.count","user":"sysadmin","dateUpdated":"2020-06-04T21:54:54+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"129762\n"}]},"apps":[],"jobName":"paragraph_1591304768172_-1289931745","id":"20200429-202207_1158636728","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23985"},{"title":"6 - View the Spark application UI","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591304768173_-536045954","id":"20200429-202205_1104714050","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23986"},{"title":"7 - Confirm that the execution of the job matches the results from toDebugString","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591304768173_-1837094994","id":"20200429-202205_1242768058","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23987"},{"title":"8 - View the details of the job","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591304768174_1390726647","id":"20200429-202204_747605927","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23988"},{"title":"9 - View the diagram of the execution plan","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591304768174_-978059918","id":"20200429-202204_413731544","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23989"},{"title":"10 - Explore the partitioning and DAG of a more complex query","text":"%spark2\nval logsRDD =sc.textFile(\"/user/zeppelin/weblogs\")\nval userReqsRDD = logsRDD.map(line => line.split(' ')).map(words => (words(2),1)).reduceByKey((v1,v2) => v1 + v2)\nval accountHitsRDD = accountsRDD.join(userReqsRDD)\naccountHitsRDD.saveAsTextFile(\"/user/zeppelin/account_hits\")","user":"sysadmin","dateUpdated":"2020-06-04T21:55:38+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1591304768175_379547791","id":"20200429-202203_721477472","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23990"},{"text":"%md\n### Explore Execution of DataFrame Queries","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591304768176_-348577501","id":"20200429-202806_748490264","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23991"},{"title":"11 - Create a DataFrame of active accounts","text":"%spark2\nval accountsDF = spark.read.table(\"telco.accounts\")\nval activeAccountsDF = accountsDF.select(\"acct_num\").where($\"acct_close_dt\".isNotNull)","user":"sysadmin","dateUpdated":"2020-06-04T21:56:01+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1591304768176_-2078564235","id":"20200429-202805_170124417","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23992"},{"title":"12 - View the full execution plan for the new DataFrame","text":"%spark2\nactiveAccountsDF.explain(true)","user":"sysadmin","dateUpdated":"2020-06-04T21:56:13+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"== Parsed Logical Plan ==\n!Filter isnotnull(acct_close_dt#241)\n+- AnalysisBarrier\n      +- Project [acct_num#239]\n         +- SubqueryAlias accounts_stage\n            +- HiveTableRelation `telco`.`accounts_stage`, org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe, [acct_num#239, acct_create_dt#240, acct_close_dt#241, first_name#242, last_name#243, address#244, city#245, state#246, zipcode#247, phone_number#248, created#249, modified#250]\n\n== Analyzed Logical Plan ==\nacct_num: int\nProject [acct_num#239]\n+- Filter isnotnull(acct_close_dt#241)\n   +- Project [acct_num#239, acct_close_dt#241]\n      +- SubqueryAlias accounts_stage\n         +- HiveTableRelation `telco`.`accounts_stage`, org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe, [acct_num#239, acct_create_dt#240, acct_close_dt#241, first_name#242, last_name#243, address#244, city#245, state#246, zipcode#247, phone_number#248, created#249, modified#250]\n\n== Optimized Logical Plan ==\nProject [acct_num#239]\n+- Filter isnotnull(acct_close_dt#241)\n   +- HiveTableRelation `telco`.`accounts_stage`, org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe, [acct_num#239, acct_create_dt#240, acct_close_dt#241, first_name#242, last_name#243, address#244, city#245, state#246, zipcode#247, phone_number#248, created#249, modified#250]\n\n== Physical Plan ==\n*(1) Project [acct_num#239]\n+- *(1) Filter isnotnull(acct_close_dt#241)\n   +- HiveTableScan [acct_close_dt#241, acct_num#239], HiveTableRelation `telco`.`accounts_stage`, org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe, [acct_num#239, acct_create_dt#240, acct_close_dt#241, first_name#242, last_name#243, address#244, city#245, state#246, zipcode#247, phone_number#248, created#249, modified#250]\n"}]},"apps":[],"jobName":"paragraph_1591304768177_141795760","id":"20200429-202803_862265902","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23993"},{"title":"13 - Execute the query","text":"%spark2\nactiveAccountsDF.show","user":"sysadmin","dateUpdated":"2020-06-04T21:56:29+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------+\n|acct_num|\n+--------+\n|       6|\n|       7|\n|       9|\n|      16|\n|      19|\n|      27|\n|      28|\n|      34|\n|      35|\n|      40|\n|      44|\n|      45|\n|      46|\n|      51|\n|      53|\n|      59|\n|      62|\n|      63|\n|      66|\n|      68|\n+--------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1591304768177_1050137520","id":"20200429-202802_502625491","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23994"},{"title":"14 - Use the Spark Application UI to view the query","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591304768178_-191958378","id":"20200429-202800_1572827814","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23995"},{"title":"15 - View the query's execution plan","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591304768179_-313270646","id":"20200429-202759_1576628165","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23996"},{"title":"16 - Review the query's execution plan","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591304768179_-356928140","id":"20200429-202759_1612498172","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23997"},{"title":"17 - View the job details for the query","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591304768180_14435419","id":"20200429-202758_2045057848","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23998"},{"title":"18 - View metrics of the execution","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591304768180_442845102","id":"20200429-202758_1197049485","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23999"},{"title":"19 - Joining different data sources","text":"%spark2\n// ------ Load account device data ---------\n// Create a DataFrame from the account device data\nval accountDeviceDF = spark.read.option(\"header\",\"true\").option(\"inferSchema\",\"true\").csv(\"/user/zeppelin/accountdevice\")\n\n// -------- query for device IDs for active accounts\n// Create a DataFrame with a device model IDs for only devices used by unclosed accounts\nval activeAcctDevsDF =  activeAccountsDF.join(accountDeviceDF,$\"acct_num\" === $\"account_id\").select($\"device_id\")","user":"sysadmin","dateUpdated":"2020-06-04T23:05:36+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"== Parsed Logical Plan ==\nRelation[id#280,account_id#281,device_id#282,activation_date#283L,account_device_id#284] csv\n\n== Analyzed Logical Plan ==\nid: int, account_id: int, device_id: int, activation_date: bigint, account_device_id: string\nRelation[id#280,account_id#281,device_id#282,activation_date#283L,account_device_id#284] csv\n\n== Optimized Logical Plan ==\nRelation[id#280,account_id#281,device_id#282,activation_date#283L,account_device_id#284] csv\n\n== Physical Plan ==\n*(1) FileScan csv [id#280,account_id#281,device_id#282,activation_date#283L,account_device_id#284] Batched: false, Format: CSV, Location: InMemoryFileIndex[hdfs://cloudairha/user/zeppelin/accountdevice], PartitionFilters: [], PushedFilters: [], ReadSchema: struct<id:int,account_id:int,device_id:int,activation_date:bigint,account_device_id:string>\n+-----+----------+---------+---------------+--------------------+\n|   id|account_id|device_id|activation_date|   account_device_id|\n+-----+----------+---------+---------------+--------------------+\n|48692|     32443|       29|  1393242509000|7351fed1-f344-4cd...|\n|48693|     32444|        4|  1353649861000|6da22278-ff7a-461...|\n|48694|     32445|        9|  1331819465000|cb993b85-6775-407...|\n|48695|     32446|       43|  1336860950000|48ea2c09-a0df-4d1...|\n|48696|     32446|       29|  1383650663000|4b49c0a6-d141-42e...|\n+-----+----------+---------+---------------+--------------------+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1591304768181_-1719665730","id":"20200429-202757_232787747","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:24000"},{"title":"20 - Analyzing the execution plan","text":"%spark2\nactiveAcctDevsDF.explain(true)","user":"sysadmin","dateUpdated":"2020-06-04T23:05:59+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"== Parsed Logical Plan ==\n'Project [unresolvedalias('device_id, None)]\n+- AnalysisBarrier\n      +- Join Inner, (acct_num#239 = account_id#281)\n         :- Project [acct_num#239]\n         :  +- Filter isnotnull(acct_close_dt#241)\n         :     +- Project [acct_num#239, acct_close_dt#241]\n         :        +- SubqueryAlias accounts_stage\n         :           +- HiveTableRelation `telco`.`accounts_stage`, org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe, [acct_num#239, acct_create_dt#240, acct_close_dt#241, first_name#242, last_name#243, address#244, city#245, state#246, zipcode#247, phone_number#248, created#249, modified#250]\n         +- Relation[id#280,account_id#281,device_id#282,activation_date#283L,account_device_id#284] csv\n\n== Analyzed Logical Plan ==\ndevice_id: int\nProject [device_id#282]\n+- Join Inner, (acct_num#239 = account_id#281)\n   :- Project [acct_num#239]\n   :  +- Filter isnotnull(acct_close_dt#241)\n   :     +- Project [acct_num#239, acct_close_dt#241]\n   :        +- SubqueryAlias accounts_stage\n   :           +- HiveTableRelation `telco`.`accounts_stage`, org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe, [acct_num#239, acct_create_dt#240, acct_close_dt#241, first_name#242, last_name#243, address#244, city#245, state#246, zipcode#247, phone_number#248, created#249, modified#250]\n   +- Relation[id#280,account_id#281,device_id#282,activation_date#283L,account_device_id#284] csv\n\n== Optimized Logical Plan ==\nProject [device_id#282]\n+- Join Inner, (acct_num#239 = account_id#281)\n   :- Project [acct_num#239]\n   :  +- Filter (isnotnull(acct_close_dt#241) && isnotnull(acct_num#239))\n   :     +- HiveTableRelation `telco`.`accounts_stage`, org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe, [acct_num#239, acct_create_dt#240, acct_close_dt#241, first_name#242, last_name#243, address#244, city#245, state#246, zipcode#247, phone_number#248, created#249, modified#250]\n   +- Project [account_id#281, device_id#282]\n      +- Filter isnotnull(account_id#281)\n         +- Relation[id#280,account_id#281,device_id#282,activation_date#283L,account_device_id#284] csv\n\n== Physical Plan ==\n*(2) Project [device_id#282]\n+- *(2) BroadcastHashJoin [acct_num#239], [account_id#281], Inner, BuildLeft\n   :- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)))\n   :  +- *(1) Project [acct_num#239]\n   :     +- *(1) Filter (isnotnull(acct_close_dt#241) && isnotnull(acct_num#239))\n   :        +- HiveTableScan [acct_close_dt#241, acct_num#239], HiveTableRelation `telco`.`accounts_stage`, org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe, [acct_num#239, acct_create_dt#240, acct_close_dt#241, first_name#242, last_name#243, address#244, city#245, state#246, zipcode#247, phone_number#248, created#249, modified#250]\n   +- *(2) Project [account_id#281, device_id#282]\n      +- *(2) Filter isnotnull(account_id#281)\n         +- *(2) FileScan csv [account_id#281,device_id#282] Batched: false, Format: CSV, Location: InMemoryFileIndex[hdfs://cloudairha/user/zeppelin/accountdevice], PartitionFilters: [], PushedFilters: [IsNotNull(account_id)], ReadSchema: struct<account_id:int,device_id:int>\n"}]},"apps":[],"jobName":"paragraph_1591304768182_-1755687771","id":"20200429-203545_1342409357","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:24001"},{"title":"21 - Analyzing the execution visualization","text":"%spark2\nactiveAcctDevsDF.write.mode(\"overwrite\").save(\"/user/zeppelin/active_account_devices\")","user":"sysadmin","dateUpdated":"2020-06-04T23:07:04+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1591304768182_1960362790","id":"20200429-203543_1186915220","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:24002"},{"title":"22 - Explore a query with multiple joins","text":"%spark2\n// Sum up the total number of each device model \nval sumDevicesDF = activeAcctDevsDF.groupBy(\"device_id\").count().withColumnRenamed(\"count\",\"active_num\")\n\n// Order by count\nval orderDevicesDF = sumDevicesDF.orderBy($\"active_num\".desc)\n\n// create a DataFrame based on the devices.json file\nval devDF = spark.read.json(\"/user/zeppelin/devices.json\")\n\n// Join the list of device model totals with the list of devices\n// to get the make and model for each device\nval joinDevicesDF = orderDevicesDF.join(devDF,orderDevicesDF(\"device_id\") === devDF(\"devnum\"))\n\n// Write out the data with the correct columns\njoinDevicesDF.select(\"device_id\",\"make\",\"model\",\"active_num\").write.mode(\"overwrite\").save(\"/user/zeppelin/top_devices\")","user":"sysadmin","dateUpdated":"2020-06-04T23:08:36+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1591304768183_1675026830","id":"20200429-205046_1687837521","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:24003"},{"text":"%md\nWe hope you've enjoyed this lab. Below are additional resources that you should find useful:\n\n1. [Hortonworks Apache Spark Tutorials](http://hortonworks.com/tutorials/#tuts-developers) are your natural next step where you can explore Spark in more depth.\n2. [Hortonworks Community Connection (HCC)](https://community.hortonworks.com/spaces/85/data-science.html?type=question) is a great resource for questions and answers on Spark, Data Analytics/Science, and many more Big Data topics.\n3. [Hortonworks Apache Spark Docs](https://docs.hortonworks.com/HDPDocuments/HDP3/HDP-3.0.1/spark-overview/content/analyzing_data_with_apache_spark.html) - official Spark documentation.\n4. [Hortonworks Apache Zeppelin Docs](https://docs.hortonworks.com/HDPDocuments/HDP3/HDP-3.0.1/zeppelin-overview/content/overview.html) - official Zeppelin documentation.\n","user":"sysadmin","dateUpdated":"2020-06-04T21:06:08+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>We hope you've enjoyed this lab. Below are additional resources that you should find useful:</p>\n<ol>\n<li><a href=\"http://hortonworks.com/tutorials/#tuts-developers\">Hortonworks Apache Spark Tutorials</a> are your natural next step where you can explore Spark in more depth.</li>\n<li><a href=\"https://community.hortonworks.com/spaces/85/data-science.html?type=question\">Hortonworks Community Connection (HCC)</a> is a great resource for questions and answers on Spark, Data Analytics/Science, and many more Big Data topics.</li>\n<li><a href=\"https://docs.hortonworks.com/HDPDocuments/HDP3/HDP-3.0.1/spark-overview/content/analyzing_data_with_apache_spark.html\">Hortonworks Apache Spark Docs</a> - official Spark documentation.</li>\n<li><a href=\"https://docs.hortonworks.com/HDPDocuments/HDP3/HDP-3.0.1/zeppelin-overview/content/overview.html\">Hortonworks Apache Zeppelin Docs</a> - official Zeppelin documentation.</li>\n</ol>\n"}]},"apps":[],"jobName":"paragraph_1591304768184_823797655","id":"20181126-133017_244739700","dateCreated":"2020-06-04T21:06:08+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:24004"}],"name":"ScalaSpark/13-ExploringQueryExecution","id":"2FCDUNTEV","noteParams":{},"noteForms":{},"angularObjects":{"md:shared_process":[],"sh:shared_process":[],"jdbc:shared_process":[],"spark2:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}