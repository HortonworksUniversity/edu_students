{"paragraphs":[{"text":"%md\n# About This Lab\n**Objective:** explore how Spark executes RDD and DataFrame/Dataset queries\n**File locations:** /devsh_loudacre/\n**Successful outcome:**\n**Before you begin:**\n**Related lessons:** Spark Distributed Processing\n\n---","user":"anonymous","dateUpdated":"2020-01-17T06:09:25-0800","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967578_-218853024","id":"20171105-200834_1116095891","dateCreated":"2020-01-17T05:49:27-0800","dateStarted":"2020-01-17T06:13:08-0800","dateFinished":"2020-01-17T06:13:08-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:13137"},{"text":"%md\n# Setup\n---\nThe following cells ensure that this notebook can run from top to bottom without errors any number of times.","user":"anonymous","dateUpdated":"2020-01-17T06:09:26-0800","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967581_-453083401","id":"20181114-164229_902436001","dateCreated":"2020-01-17T05:49:27-0800","dateStarted":"2020-01-17T06:13:08-0800","dateFinished":"2020-01-17T06:13:08-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13138"},{"text":"%md\n# Lab\n---","user":"anonymous","dateUpdated":"2020-01-17T06:09:26-0800","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967583_-1600759205","id":"20181114-164844_1661453681","dateCreated":"2020-01-17T05:49:27-0800","dateStarted":"2020-01-17T06:13:08-0800","dateFinished":"2020-01-17T06:13:08-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13139"},{"text":"%md\n### Explore Partitioning of File-Based RDDs\n\nReview the accounts data files in HDFS. (Refer to the data file location shown at the start of this exercise.) Take note of the number and sizes of files.","user":"anonymous","dateUpdated":"2020-01-17T06:09:26-0800","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967584_1432984861","id":"20200117-044357_507670769","dateCreated":"2020-01-17T05:49:27-0800","dateStarted":"2020-01-17T06:13:08-0800","dateFinished":"2020-01-17T06:13:08-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13140"},{"title":"1 - Create an RDD called accountsRDD by reading the accounts data, splitting it by commas, and keying it by account ID, which is the first field of each line","text":"%spark\n\n","user":"anonymous","dateUpdated":"2020-01-17T06:09:26-0800","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967587_1644522355","id":"20200117-044459_2003586621","dateCreated":"2020-01-17T05:49:27-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13141"},{"title":"2 - Find the number of partitions in the new RDD","text":"%spark\n\n","user":"anonymous","dateUpdated":"2020-01-17T06:09:26-0800","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967589_333353598","id":"20200117-044723_1102357003","dateCreated":"2020-01-17T05:49:27-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13142"},{"text":"%md\nUse toDebugString to view the lineage and execution plan of accountsRDD.\nHow many partitions are in the resulting RDD? How may stages does the query have?","user":"anonymous","dateUpdated":"2020-01-17T06:09:26-0800","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967592_-366069543","id":"20200117-044835_1375433688","dateCreated":"2020-01-17T05:49:27-0800","dateStarted":"2020-01-17T06:13:08-0800","dateFinished":"2020-01-17T06:13:08-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13143"},{"title":"3 - Use toDebugString to view the lineage and execution plan of accountsRDD","text":"%spark\n\n","user":"anonymous","dateUpdated":"2020-01-17T06:09:26-0800","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967594_-1225255731","id":"20200117-044833_1225781822","dateCreated":"2020-01-17T05:49:27-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13144"},{"text":"%md\n### Explore Execution of RDD Queries\n\nCall count on accountsRDD to count the number of accounts. This will trigger execution of a job.","user":"anonymous","dateUpdated":"2020-01-17T06:09:26-0800","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967596_-658821451","id":"20200117-045340_1571704960","dateCreated":"2020-01-17T05:49:27-0800","dateStarted":"2020-01-17T06:13:09-0800","dateFinished":"2020-01-17T06:13:09-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13145"},{"title":"4 - Call count on accountsRDD to count the number of accounts","text":"%spark\n\n","user":"anonymous","dateUpdated":"2020-01-17T06:09:26-0800","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967598_800478098","id":"20200117-045414_2096176284","dateCreated":"2020-01-17T05:49:27-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13146"},{"text":"%md\nIn the browser, view the application in the YARN RM UI using the provided bookmark (or http://localhost:8088) and click through to view the Spark Application UI.","user":"anonymous","dateUpdated":"2020-01-17T06:09:26-0800","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967600_-644590428","id":"20200117-045630_789605596","dateCreated":"2020-01-17T05:49:27-0800","dateStarted":"2020-01-17T06:13:09-0800","dateFinished":"2020-01-17T06:13:09-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13147"},{"text":"%md\nMake sure the Jobs tab is selected, and review the list of completed jobs.\nThe most recent job, which you triggered by calling count, should be at the top of the list.\n(Note that the job description is usually based on the action that triggered the job execution.)\nConfirm that the number of stages is correct, and the number of tasks completed for the job matches the number of RDD partitions you noted when you used toDebugString.","user":"anonymous","dateUpdated":"2020-01-17T06:09:27-0800","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967602_1332984418","id":"20200117-045706_1428741707","dateCreated":"2020-01-17T05:49:27-0800","dateStarted":"2020-01-17T06:13:09-0800","dateFinished":"2020-01-17T06:13:09-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13148"},{"text":"%md\nClick on the job description to view details of the job.\nThis will list all the stages in the job, which in this case is one.","user":"anonymous","dateUpdated":"2020-01-17T06:09:27-0800","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967604_-1501375892","id":"20200117-045808_179196009","dateCreated":"2020-01-17T05:49:27-0800","dateStarted":"2020-01-17T06:13:09-0800","dateFinished":"2020-01-17T06:13:09-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13149"},{"text":"%md\nClick on DAG Visualization to see a diagram of the execution plan based on the RDD’s lineage.\nThe main diagram displays only the stages, but if you click on a stage, it will show you the tasks within that stage.","user":"anonymous","dateUpdated":"2020-01-17T06:09:27-0800","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967606_2039497691","id":"20200117-050724_564772540","dateCreated":"2020-01-17T05:49:27-0800","dateStarted":"2020-01-17T06:13:09-0800","dateFinished":"2020-01-17T06:13:09-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13150"},{"text":"%md\n### Optional: \nExplore the partitioning and DAG of a more complex query like the one below. Before you view the execution plan or job details, try to figure out how many stages the job will have.\n\n```spark\nval logs = sc.textFile(\"/devsh_loudacre/weblogs\")\nval userReqsRDD = logs.map(line => line.split(' ')).map(words => (words(2),1)).reduceByKey((v1,v2) => v1 + v2)\nval accountHitsRDD = accountsRDD.join(userReqsRDD)\n```\n\nThis query loads Loudacre’s web log data, and calculates how many times each user visited. Then it joins that user count data with account data for each user.","user":"anonymous","dateUpdated":"2020-01-17T06:09:27-0800","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967608_-702699209","id":"20200117-050851_1123289202","dateCreated":"2020-01-17T05:49:27-0800","dateStarted":"2020-01-17T06:13:09-0800","dateFinished":"2020-01-17T06:13:09-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13151"},{"title":"5 - Explore the partitioning and DAG of a more complex query","text":"%spark\n\n","user":"anonymous","dateUpdated":"2020-01-17T06:09:27-0800","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967611_773677541","id":"20200117-051205_1521067842","dateCreated":"2020-01-17T05:49:27-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13152"},{"text":"%md\n**Note:** If you execute the query multiple times, you may note that some tasks within a stage are marked as “skipped.” \nThis is because whenever a shuffle operation is executed, Spark temporarily caches the data that was shuffled. \nSubsequent executions of the same query re-use that data if it’s available to save some steps and improve performance.","user":"anonymous","dateUpdated":"2020-01-17T06:09:27-0800","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967613_367579047","id":"20200117-051534_965974048","dateCreated":"2020-01-17T05:49:27-0800","dateStarted":"2020-01-17T06:13:09-0800","dateFinished":"2020-01-17T06:13:09-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13153"},{"text":"%md\n### Explore Execution of DataFrame Queries","user":"anonymous","dateUpdated":"2020-01-17T06:09:27-0800","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967615_-734541297","id":"20200117-051730_1309419952","dateCreated":"2020-01-17T05:49:27-0800","dateStarted":"2020-01-17T06:13:09-0800","dateFinished":"2020-01-17T06:13:09-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13154"},{"title":"6 - Create a DataFrame of active accounts from the accounts table in the devsh database","text":"%spark\n\n","user":"anonymous","dateUpdated":"2020-01-17T06:09:28-0800","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967617_-1637690203","id":"20200117-051759_1282938945","dateCreated":"2020-01-17T05:49:27-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13155"},{"title":"7 - View the full execution plan for the new DataFrame.","text":"%spark\n","user":"anonymous","dateUpdated":"2020-01-17T06:09:28-0800","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967619_2035653976","id":"20200117-052516_1058306200","dateCreated":"2020-01-17T05:49:27-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13156"},{"text":"%md\nCan you locate the line in the physical plan corresponding to the command to load the devsh.accounts table into a DataFrame?\nHow many stages do you think this query has?","user":"anonymous","dateUpdated":"2020-01-17T06:09:28-0800","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967621_1234283039","id":"20200117-052625_2036810127","dateCreated":"2020-01-17T05:49:27-0800","dateStarted":"2020-01-17T06:13:09-0800","dateFinished":"2020-01-17T06:13:09-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13157"},{"title":"8 - Call the DataFrame’s show function to execute the query","text":"%spark\n\n","user":"anonymous","dateUpdated":"2020-01-17T06:09:28-0800","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967624_-1158265261","id":"20200117-052736_1379537345","dateCreated":"2020-01-17T05:49:27-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13158"},{"text":"%md\nView the Spark Application UI and choose the SQL tab. \nThis displays a list of DataFrame and Dataset queries you have executed, with the most recent query at the top.","user":"anonymous","dateUpdated":"2020-01-17T06:09:28-0800","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967626_1276670917","id":"20200117-052958_2003036727","dateCreated":"2020-01-17T05:49:27-0800","dateStarted":"2020-01-17T06:13:09-0800","dateFinished":"2020-01-17T06:13:09-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13159"},{"text":"%md\nClick the description for the top query to see the visualization of the query’s execution.\nYou can also see the query’s full execution plan by opening the Details panel below the visualization graph.","user":"anonymous","dateUpdated":"2020-01-17T06:09:28-0800","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967628_-691075777","id":"20200117-053031_478789607","dateCreated":"2020-01-17T05:49:27-0800","dateStarted":"2020-01-17T06:13:10-0800","dateFinished":"2020-01-17T06:13:10-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13160"},{"text":"%md\nThe first step in the execution is a HiveTableScan, which loaded the account data into the DataFrame.\nHover your mouse over the step to show the step’s execution plan. Compare that to the physical plan for the query.\nNote that it is the same as the last line in the physical execution plan, because it is the first step to execute.\nDid you correctly identify this line in the execution plan as the one corresponding to the DataFrame.read.table operation?","user":"anonymous","dateUpdated":"2020-01-17T06:09:28-0800","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967630_941397874","id":"20200117-053101_120350036","dateCreated":"2020-01-17T05:49:27-0800","dateStarted":"2020-01-17T06:13:10-0800","dateFinished":"2020-01-17T06:13:10-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13161"},{"text":"%md\nClick the SQL tab to return to the main SQL query summary tab.\nThe Job IDs column provides links to the jobs that executed as part of this query execution.\nIn this case, the query consisted of just a single job.\nClick the job’s ID to view the job details.\nThis will display a list of stages that were completed for the query.\n\n* How many stages executed? \n* Is that the number of stages you predicted it would be?","user":"anonymous","dateUpdated":"2020-01-17T06:09:28-0800","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967632_1588070501","id":"20200117-053143_1088049350","dateCreated":"2020-01-17T05:49:27-0800","dateStarted":"2020-01-17T06:13:10-0800","dateFinished":"2020-01-17T06:13:10-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13162"},{"text":"%md\n**Optional:** Click the description of the stage to view metrics on the execution of the stage and its tasks.","user":"anonymous","dateUpdated":"2020-01-17T06:09:28-0800","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967634_495114260","id":"20200117-053250_1980302210","dateCreated":"2020-01-17T05:49:27-0800","dateStarted":"2020-01-17T06:13:10-0800","dateFinished":"2020-01-17T06:13:10-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13163"},{"text":"%md\nThe previous query was very simple, involving just a single data source with a where to return only active accounts.\nTry executing a more complex query that joins data from two different data sources.\nThis query reads in the accountdevice data file, which maps account IDs to associated device IDs.\nThen it joins that data with the DataFrame of active accounts you created above.\nThe result is DataFrame consisting of all device IDs in use by currently active accounts.\n\n```spark\nval accountDeviceDF = spark.read.option(\"header\",\"true\").option(\"inferSchema\",\"true\").csv(\"/devsh_loudacre/accountdevice\")\nval activeAcctDevsDF = activeAccountsDF.join(accountDeviceDF,$\"acct_num\" === $\"account_id\").select($\"device_id\")\n```","user":"anonymous","dateUpdated":"2020-01-17T06:09:29-0800","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967636_-1009438751","id":"20200117-053330_26904564","dateCreated":"2020-01-17T05:49:27-0800","dateStarted":"2020-01-17T06:13:10-0800","dateFinished":"2020-01-17T06:13:10-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13164"},{"title":"9 - Try executing a more complex query that joins data from two different data sources","text":"%spark\n\n","user":"anonymous","dateUpdated":"2020-01-17T06:09:29-0800","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967638_803081146","id":"20200117-053639_1801859674","dateCreated":"2020-01-17T05:49:27-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13165"},{"text":"%md\nReview the full execution plan using explain, as you did with the previous DataFrame.\nCan you identify which lines in the execution plan load the two different data sources?\nHow many stages do you think this query will execute?","user":"anonymous","dateUpdated":"2020-01-17T06:09:29-0800","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967640_-695985459","id":"20200117-054116_1603737239","dateCreated":"2020-01-17T05:49:27-0800","dateStarted":"2020-01-17T06:13:10-0800","dateFinished":"2020-01-17T06:13:10-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13166"},{"text":"%md\nExecute the query and review the execution visualization in the Spark UI.\n\n* What differences do you see between the execution of the earlier query and this one?\n* How many stages executed? \n* Is this what you expected?","user":"anonymous","dateUpdated":"2020-01-17T06:09:29-0800","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967646_-843487520","id":"20200117-054309_1513388745","dateCreated":"2020-01-17T05:49:27-0800","dateStarted":"2020-01-17T06:13:10-0800","dateFinished":"2020-01-17T06:13:10-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13167"},{"text":"%md\n**Optional: Explore an even more complex query that involves multiple joins with three data sources** \nYou can use the last query in the solutions file for this exercise (in the /home/trainingtraining_materials/devsh/exercises/query-execution/solution/ directory). \nThat query creates a list of device IDs, makes, and models, and the number of active accounts that use that type of device, sorted in order from most popular device type to least.","user":"anonymous","dateUpdated":"2020-01-17T06:09:29-0800","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967648_346055244","id":"20200117-054421_1624313613","dateCreated":"2020-01-17T05:49:27-0800","dateStarted":"2020-01-17T06:13:10-0800","dateFinished":"2020-01-17T06:13:10-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13168"},{"text":"%md\n# Result\n**You have now:**\n\n* explored RDD partitioning and lineage-based execution plans using the Spark and the Spark Application UI and\n* explored how Catalyst executes DataFrame and Dataset queries.\n\n---","user":"anonymous","dateUpdated":"2020-01-17T06:09:29-0800","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967650_941820281","id":"20181119-142716_792318228","dateCreated":"2020-01-17T05:49:27-0800","dateStarted":"2020-01-17T06:13:10-0800","dateFinished":"2020-01-17T06:13:10-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13169"},{"text":"%md\n# Solution\n---","user":"anonymous","dateUpdated":"2020-01-17T06:09:29-0800","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967652_-537783821","id":"20171113-155535_1769142099","dateCreated":"2020-01-17T05:49:27-0800","dateStarted":"2020-01-17T06:13:11-0800","dateFinished":"2020-01-17T06:13:11-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13170"},{"title":"1 - Create an RDD called accountsRDD by reading the accounts data, splitting it by commas, and keying it by account ID, which is the first field of each line","text":"%spark\n\nval accountsRDD = sc.textFile(\"/user/hive/warehouse/devsh.db/accounts\").map(line => line.split(',')).map(account => (account(0),account))","user":"anonymous","dateUpdated":"2020-01-17T06:09:30-0800","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967654_-182398957","id":"20200117-044545_184891645","dateCreated":"2020-01-17T05:49:27-0800","dateStarted":"2020-01-17T06:13:11-0800","dateFinished":"2020-01-17T06:13:11-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13171"},{"title":"2 - Find the number of partitions in the new RDD","text":"%spark\n\naccountsRDD.getNumPartitions","user":"anonymous","dateUpdated":"2020-01-17T06:09:30-0800","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967656_2096551397","id":"20200117-044740_410268300","dateCreated":"2020-01-17T05:49:27-0800","dateStarted":"2020-01-17T06:13:11-0800","dateFinished":"2020-01-17T06:13:11-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13172"},{"title":"3 - Use toDebugString to view the lineage and execution plan of accountsRDD","text":"%spark\n\naccountsRDD.toDebugString","user":"anonymous","dateUpdated":"2020-01-17T06:09:30-0800","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"editorHide":false,"title":true,"results":{"0":{"graph":{"mode":"table","height":97.45,"optionOpen":false}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967658_808893267","id":"20200117-044931_905827162","dateCreated":"2020-01-17T05:49:27-0800","dateStarted":"2020-01-17T06:13:11-0800","dateFinished":"2020-01-17T06:13:11-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13173"},{"title":"4 - Call count on accountsRDD to count the number of accounts","text":"%spark\n\naccountsRDD.count","user":"anonymous","dateUpdated":"2020-01-17T06:09:30-0800","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967661_775293397","id":"20200117-045513_637956581","dateCreated":"2020-01-17T05:49:27-0800","dateStarted":"2020-01-17T06:13:11-0800","dateFinished":"2020-01-17T06:13:19-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13174"},{"title":"5 - Explore the partitioning and DAG of a more complex query","text":"%spark\n\nval logs = sc.textFile(\"/devsh_loudacre/weblogs\")\nval userReqsRDD = logs.map(line => line.split(' ')).map(words => (words(2),1)).reduceByKey((v1,v2) => v1 + v2)\nval accountHitsRDD = accountsRDD.join(userReqsRDD)","user":"anonymous","dateUpdated":"2020-01-17T06:09:31-0800","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967663_514168636","id":"20200117-051509_1183347014","dateCreated":"2020-01-17T05:49:27-0800","dateStarted":"2020-01-17T06:13:19-0800","dateFinished":"2020-01-17T06:13:19-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13175"},{"title":"6 - Create a DataFrame of active accounts from the accounts table in the devsh database","text":"%spark\n\nval accountsDF = spark.read.table(\"devsh.accounts\")\nval activeAccountsDF = accountsDF.select(\"acct_num\").where($\"acct_close_dt\".isNull)","user":"anonymous","dateUpdated":"2020-01-17T06:09:32-0800","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967666_-1775755511","id":"20200117-051822_1933457879","dateCreated":"2020-01-17T05:49:27-0800","dateStarted":"2020-01-17T06:13:19-0800","dateFinished":"2020-01-17T06:13:20-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13176"},{"title":"7 - View the full execution plan for the new DataFrame.","text":"%spark\n\nactiveAccountsDF.explain(true)","user":"anonymous","dateUpdated":"2020-01-17T06:09:32-0800","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967668_530664323","id":"20200117-052532_1956675346","dateCreated":"2020-01-17T05:49:27-0800","dateStarted":"2020-01-17T06:13:20-0800","dateFinished":"2020-01-17T06:13:20-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13177"},{"title":"8 - Call the DataFrame’s show function to execute the query","text":"%spark\n\nactiveAccountsDF.show","user":"anonymous","dateUpdated":"2020-01-17T06:09:32-0800","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967671_-1311472623","id":"20200117-052804_2089720584","dateCreated":"2020-01-17T05:49:27-0800","dateStarted":"2020-01-17T06:13:20-0800","dateFinished":"2020-01-17T06:13:21-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13178"},{"title":"9 - Try executing a more complex query that joins data from two different data sources","text":"%spark\n\nval accountDeviceDF = spark.read.option(\"header\",\"true\").option(\"inferSchema\",\"true\").csv(\"/devsh_loudacre/accountdevice\")\nval activeAcctDevsDF = activeAccountsDF.join(accountDeviceDF,$\"acct_num\" === $\"account_id\").select($\"device_id\")","user":"anonymous","dateUpdated":"2020-01-17T06:09:33-0800","config":{"tableHide":true,"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967674_-1918764654","id":"20200117-053843_722086419","dateCreated":"2020-01-17T05:49:27-0800","dateStarted":"2020-01-17T06:13:21-0800","dateFinished":"2020-01-17T06:13:25-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13179"},{"title":"Additional resources","text":"%md\nWe hope you've enjoyed this lab. Below are additional resources that you should find useful:\n\n1. [Cloudera Tutorials](http://cloudera.com/tutorials.html) are your natural next step where you can explore Spark in more depth.\n2. [Cloudera Community](https://community.cloudera.com) is a great resource for questions and answers on Spark, Data Analytics/Science, and many more Big Data topics.\n3. [Apache Spark Documentation](https://spark.apache.org/documentation.html) - official Spark documentation.\n4. [Apache Zeppelin Project Home Page](https://zeppelin.apache.org) - official Zeppelin web site.\n","user":"anonymous","dateUpdated":"2020-01-17T06:09:34-0800","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":10,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967676_452498009","id":"20181116-135131_93712280","dateCreated":"2020-01-17T05:49:27-0800","dateStarted":"2020-01-17T06:13:25-0800","dateFinished":"2020-01-17T06:13:25-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13180"},{"text":"%angular\n</br>\n</br>\n</br>\n</br>\n<center>\n<a href=\"https://www.cloudera.com/about/training/courses.html\">\n  <img src=\"https://www.cloudera.com/content/dam/www/marketing/media-kit/logo-assets/cloudera_logo_darkorange.png\" alt=\"Cloudera Educational Services\" style=\"width:280px;height:40px;border:0;\" align=\"middle\">\n</a>\n</center>\n</br>\n</br>","user":"anonymous","dateUpdated":"2020-01-17T06:09:34-0800","config":{"tableHide":false,"editorSetting":{"language":"scala","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":2,"editorMode":"ace/mode/undefined","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967678_574402926","id":"20200110-154537_1406191376","dateCreated":"2020-01-17T05:49:27-0800","dateStarted":"2020-01-17T06:13:25-0800","dateFinished":"2020-01-17T06:13:25-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13181"},{"text":"%angular\n","user":"anonymous","dateUpdated":"2020-01-17T06:09:34-0800","config":{"editorSetting":{"language":"scala","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/undefined","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579268967681_148629362","id":"20200110-162013_302547143","dateCreated":"2020-01-17T05:49:27-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13182"}],"name":"Labs/Scala/ExploringQueryExecution","id":"2EYQ3AHWG","noteParams":{},"noteForms":{},"angularObjects":{"md:shared_process":[],"angular:shared_process":[],"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}